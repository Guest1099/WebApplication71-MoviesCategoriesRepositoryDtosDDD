@model CreateMovieDto

<div class="dodawanieHeader">
    <span class="titleHeader">Dodawanie nowej pozycji</span>
</div>

<form method="post" asp-action="Create" asp-controller="Movies" enctype="multipart/form-data" id="movieForm">
    <table>
        <tr>
            <td class="leftColumn">
                <label asp-for="Title"></label>
            </td>
            <td class="rightColumn">
                <div class="db">
                    <input asp-for="Title" />
                    <span asp-validation-for="Title" class="c-red"></span>
                </div>
            </td>
        </tr>
        <tr>
            <td class="leftColumn">
                <label asp-for="Description"></label>
            </td>
            <td class="rightColumn">
                <div class="db">
                    <div id="toolbar">
                        <button type="button" onclick="execCmd('bold')">B</button>
                        <button type="button" onclick="execCmd('italic')">I</button>
                        <button type="button" onclick="execCmd('underline')">U</button>
                        <button type="button" onclick="execCmd('strikethrough')">S</button>
                        <button type="button" onclick="execCmd('justifyLeft')">←</button>
                        <button type="button" onclick="execCmd('justifyCenter')">⊗</button>
                        <button type="button" onclick="execCmd('justifyRight')">→</button>
                        <button type="button" onclick="execCmd('insertOrderedList')">1.</button>
                        <button type="button" onclick="insertUnorderedList()">•</button>
                        <button type="button" onclick="execCmd('createLink')">Link</button>
                        
                        <select id="fontSizeSelect" onchange="changeFontSize(this.value)">
                            <option value="8">8px</option>
                            <option value="9">9px</option>
                            <option value="10">10px</option>
                            <option value="11">11px</option>
                            <option value="12">12px</option>
                            <option value="13">13px</option>
                            <option value="14">14px</option>
                            <option value="15">15px</option>
                            <option value="16">16px</option>
                            <option value="17">17px</option>
                            <option value="18">18px</option>
                            <option value="19">19px</option>
                            <option value="20">20px</option>
                            <option value="21">21px</option>
                            <option value="22">22px</option>
                            <option value="23">23px</option>
                            <option value="24">24px</option>
                        </select>

                        <select id="fontColorSelect" onchange="execCmd('foreColor', this.value)">
                            <option value="#000000">Czarny</option>
                            <option value="#FF0000">Czerwony</option>
                            <option value="#00FF00">Zielony</option>
                            <option value="#0000FF">Niebieski</option>
                            <option value="#FFFF00">Żółty</option>
                            <option value="#FF00FF">Fioletowy</option>
                            <option value="#00FFFF">Błękitny</option>
                            <option value="#800000">Bordowy</option>
                            <option value="#008000">Zielony ciemny</option>
                            <option value="#000080">Granatowy</option>
                            <option value="#808000">Oliwkowy</option>
                            <option value="#800080">Purpurowy</option>
                        </select>
                    </div>
                    <div id="editor" contenteditable="true"></div>
                    <input type="hidden" id="description" name="Description" />
                </div>
            </td>
        </tr>
        <tr>
            <td class="leftColumn">
                <label asp-for="Price"></label>
            </td>
            <td class="rightColumn">
                <div class="db">
                    <input asp-for="Price" />
                    <span asp-validation-for="Price" class="c-red"></span>
                </div>
            </td>
        </tr>
        <tr>
            <td class="leftColumn">
                <label asp-for="CategoryId">Kategoria</label>
            </td>
            <td class="rightColumn">
                <div class="db">
                    <select asp-for="CategoryId" asp-items="Model.CategoriesList" class="w-200px form-input2"></select>
                    <span asp-validation-for="CategoryId" class="c-red"></span>
                </div>
            </td>
        </tr>
        <tr>
            <td class="leftColumn">
                <span>Dodaj zdjęcie</span>
            </td>
            <td class="rightColumn">
                <div class="db fieldEdit">
                    <div id="imageContainer" class="db"></div>
                    <input id="files" asp-for="Files" accept="image/*" multiple onchange="saveFiles();" />
                </div>
            </td>
        </tr>
    </table>

    <div class="w-100 df-sb mt-30 mb-40">
        <a asp-action="Index" asp-controller="Movies" class="buttonWstecz w-100px">Wstecz</a>
        <div class="df">
            <input type="submit" value="Zapisz" class="buttonEdit w-100px" />
            <a asp-action="Index" asp-controller="Movies" class="buttonAnuluj w-100px ml-2">Anuluj</a>
        </div>
    </div>
</form>



<span class="c-red">@ViewData["ErrorMessage"]</span>






@section Scripts {
    <script type="text/javascript">
        // Funkcja do aktualizacji ukrytego pola Description
        function updateDescription() {
            var editorContent = document.getElementById('editor').innerHTML;
            document.getElementById('description').value = editorContent;
        }

        // Funkcja do dodania wypunktowanej listy
        function insertUnorderedList() {
            const editor = document.getElementById('editor');
            const selection = window.getSelection();
            const range = selection.getRangeAt(0);
            const list = document.createElement('ul');  // Tworzymy element listy
            const listItem = document.createElement('li');  // Tworzymy pojedynczy element listy

            // Jeśli tekst jest zaznaczony, wstawiamy go jako element listy
            if (selection.toString().length > 0) {
                listItem.textContent = selection.toString();  // Przypisujemy zaznaczony tekst
                list.appendChild(listItem);  // Dodajemy element listy
                range.deleteContents();  // Usuwamy zaznaczony tekst
                range.insertNode(list);  // Wstawiamy nową listę w miejscu zaznaczenia
            }
        }

        // Funkcja do zmiany rozmiaru czcionki
        function changeFontSize(size) {
            const selection = window.getSelection();
            if (selection.rangeCount) {
                const range = selection.getRangeAt(0);
                const span = document.createElement("span");
                span.style.fontSize = size + "px";
                range.surroundContents(span);
            }
        }

        // Funkcja do wykonania komend w edytorze
        function execCmd(command, value = null) {
            if (command === 'createLink') {
                const url = prompt("Wprowadź adres URL:", "https://");
                if (url) {
                    document.execCommand(command, false, url);
                }
            } else if (command === 'foreColor' && value) {
                document.execCommand(command, false, value);
            } else {
                document.execCommand(command, false, null);
            }
        }

        // Podpięcie aktualizacji zawartości przed wysłaniem formularza
        document.getElementById('movieForm').addEventListener('submit', function () {
            updateDescription();
        });

        document.getElementById('editor').addEventListener('input', function () {
            console.log('Edytor został zmieniony!');
        });
    </script>
}
